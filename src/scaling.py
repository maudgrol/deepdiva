import os
import numpy as np
import pandas as pd
import pickle

from norm_functions import *
from scale_functions import *

DATA_PATH = "../../data/"

df = pd.read_csv(os.path.join(DATA_PATH, "mapping_parameters_5.csv"), sep=";", header=0)
function_df = df.loc[pd.isna(df.param_id) == False, ["param_id", "scale_function", "norm_function"]]
print(function_df)
missing_df = pd.DataFrame(data=[[17,"scale_placeholder","norm_placeholder"],
                                [18,"scale_placeholder","norm_placeholder"],
                                [19,"scale_placeholder","norm_placeholder"]], columns=["param_id", "scale_function", "norm_function"])
function_df = function_df.append(missing_df, ignore_index=True).sort_values(by="param_id").reset_index(drop=True)

norm_dict_temp = {int(i) : function_df.loc[i, "norm_function"] for i in function_df.param_id}
scale_dict_temp = {int(i) : function_df.loc[i, "scale_function"] for i in function_df.param_id}

norm_dict = {0: norm_float_0_200,
             1: norm_int_0_1,
             2: norm_int_0_1,
             3: norm_float_0_1,
             4: norm_int_0_7,
             5: norm_int_0_6,
             6: norm_int_0_4,
             7: norm_int_0_1,
             8: norm_float_0_100,
             9: norm_float_100_100,
             10: norm_float_0_100,
             11: norm_int_0_26,
             12: norm_int_0_26,
             13: norm_int_0_1,
             14: norm_int_24_24,
             15: norm_float_100_100,
             16: norm_int_0_2,
             17: norm_placeholder,
             18: norm_placeholder,
             19: norm_placeholder,
             20: norm_float_0_100,
             21: norm_float_0_100,
             22: norm_float_0_100,
             23: norm_float_0_100,
             24: norm_float_0_100,
             25: norm_float_100_100,
             26: norm_float_100_100,
             27: norm_float_100_100,
             28: norm_float_100_100,
             29: norm_float_100_100,
             30: norm_float_100_100,
             31: norm_float_100_100,
             32: norm_float_100_100,
             33: norm_float_0_100,
             34: norm_float_0_100,
             35: norm_float_0_100,
             36: norm_float_0_100,
             37: norm_float_0_100,
             38: norm_int_0_2,
             39: norm_placeholder,
             40: norm_int_0_1,
             41: norm_int_0_1,
             42: norm_int_0_1,
             43: norm_float_0_100,
             44: norm_float_0_100,
             45: norm_float_0_100,
             46: norm_float_0_100,
             47: norm_float_0_100,
             48: norm_float_0_100,
             49: norm_int_0_2,
             50: norm_placeholder,
             51: norm_int_0_1,
             52: norm_int_0_1,
             53: norm_int_0_1,
             54: norm_float_0_100,
             55: norm_int_m3_23,
             56: norm_int_0_3,
             57: norm_int_0_7,
             58: norm_float_0_100,
             59: norm_float_0_100,
             60: norm_int_0_23,
             61: norm_float_0_100,
             62: norm_float_5_5,
             63: norm_int_0_23,
             64: norm_float_5_5,
             65: norm_int_3_23,
             66: norm_int_0_3,
             67: norm_int_0_7,
             68: norm_float_0_100,
             69: norm_float_0_100,
             70: norm_int_0_23,
             71: norm_float_0_100,
             72: norm_float_5_5,
             73: norm_int_0_23,
             74: norm_float_5_5,
             75: norm_float_2_100,
             76: norm_float_0_100,
             77: norm_int_0_23,
             78: norm_int_0_23,
             79: norm_int_0_23,
             80: norm_int_0_23,
             81: norm_int_0_23,
             82: norm_int_0_23,
             83: norm_int_0_23,
             84: norm_int_0_23,
             85: norm_int_0_4,
             86: norm_fixed_octave,
             87: norm_float_30_30,
             88: norm_float_30_30,
             89: norm_float_0_100,
             90: norm_float_0_100,
             91: norm_float_1_9,
             92: norm_float_1_9,
             93: norm_float_1_9,
             94: norm_float_0_100,
             95: norm_int_0_1,
             96: norm_float_0_100,
             97: norm_float_0_100,
             98: norm_float_0_100,
             99: norm_float_0_100,
             100: norm_int_0_3,
             101: norm_int_0_5,
             102: norm_int_0_5,
             103: norm_int_0_23,
             104: norm_float_24_24,
             105: norm_int_0_23,
             106: norm_float_24_24,
             107: norm_int_0_23,
             108: norm_float_50_50,
             109: norm_int_0_23,
             110: norm_float_50_50,
             111: norm_int_0_1,
             112: norm_int_0_1,
             113: norm_int_0_1,
             114: norm_int_0_1,
             115: norm_int_0_1,
             116: norm_int_0_1,
             117: norm_int_0_1,
             118: norm_int_0_1,
             119: norm_int_0_1,
             120: norm_int_0_2,
             121: norm_int_0_1,
             122: norm_int_0_4,
             123: norm_int_0_1,
             124: norm_int_0_1,
             125: norm_int_0_1,
             126: norm_int_0_1,
             127: norm_int_0_1,
             128: norm_int_0_1,
             129: norm_int_0_1,
             130: norm_placeholder,
             131: norm_int_1_4,
             132: norm_int_1_4,
             133: norm_int_0_1,
             134: norm_float_0_200,
             135: norm_int_0_23,
             136: norm_float_100_100,
             137: norm_int_0_23,
             138: norm_float_100_100,
             139: norm_int_0_3,
             140: norm_float_30_150,
             141: norm_float_0_100,
             142: norm_int_1_2,
             143: norm_placeholder,
             144: norm_int_0_23,
             145: norm_float_120_120,
             146: norm_int_m1_3,
             147: norm_float_0_4,
             148: norm_float_0_150,
             149: norm_float_0_100,
             150: norm_int_0_23,
             151: norm_float_120_120,
             152: norm_int_0_23,
             153: norm_float_120_120,
             154: norm_float_0_100,
             155: norm_float_24_24,
             156: norm_int_0_1,
             157: norm_int_0_1,
             158: norm_int_1_2,
             159: norm_int_0_3,
             160: norm_float_0_100,
             161: norm_int_0_23,
             162: norm_float_100_100,
             163: norm_int_0_23,
             164: norm_float_24_24,
             165: norm_int_0_23,
             166: norm_float_100_100,
             167: norm_float_100_100,
             168: norm_float_0_100,
             169: norm_int_0_1,
             170: norm_int_0_23,
             171: norm_float_100_100,
             172: norm_int_0_23,
             173: norm_float_100_100,
             174: norm_int_0_23,
             175: norm_placeholder,
             176: norm_float_8_8,
             177: norm_float_5_5,
             178: norm_int_0_4,
             179: norm_int_0_2,
             180: norm_float_0_100,
             181: norm_float_0_100,
             182: norm_float_0_100,
             183: norm_int_0_1,
             184: norm_float_0_100,
             185: norm_float_0_100,
             186: norm_float_50_50,
             187: norm_int_0_1,
             188: norm_float_0_100,
             189: norm_float_0_100,
             190: norm_float_0_250,
             191: norm_float_0_100,
             192: norm_float_0_100,
             193: norm_float_0_100,
             194: norm_float_1_200,
             195: norm_float_0_100,
             196: norm_float_0_100,
             197: norm_float_1_16,
             198: norm_float_1_16,
             199: norm_float_1_16,
             200: norm_float_0_100,
             201: norm_float_0_100,
             202: norm_float_0_100,
             203: norm_float_0_100,
             204: norm_float_0_100,
             205: norm_float_0_100,
             206: norm_float_0_100,
             207: norm_int_0_2,
             208: norm_float_0_100,
             209: norm_float_0_100,
             210: norm_float_0_100,
             211: norm_float_0_100,
             212: norm_float_20_20,
             213: norm_float_0_100,
             214: norm_float_0_100,
             215: norm_float_0_100,
             216: norm_int_0_3,
             217: norm_int_0_4,
             218: norm_int_0_2,
             219: norm_float_0_100,
             220: norm_float_0_100,
             221: norm_float_0_100,
             222: norm_int_0_1,
             223: norm_float_0_100,
             224: norm_float_0_100,
             225: norm_float_50_50,
             226: norm_int_0_1,
             227: norm_float_0_100,
             228: norm_float_0_100,
             229: norm_float_0_250,
             230: norm_float_0_100,
             231: norm_float_0_100,
             232: norm_float_0_100,
             233: norm_float_1_200,
             234: norm_float_0_100,
             235: norm_float_0_100,
             236: norm_float_1_16,
             237: norm_float_1_16,
             238: norm_float_1_16,
             239: norm_float_0_100,
             240: norm_float_0_100,
             241: norm_float_0_100,
             242: norm_float_0_100,
             243: norm_float_0_100,
             244: norm_float_0_100,
             245: norm_float_0_100,
             246: norm_int_0_2,
             247: norm_float_0_100,
             248: norm_float_0_100,
             249: norm_float_0_100,
             250: norm_float_0_100,
             251: norm_float_20_20,
             252: norm_float_0_100,
             253: norm_float_0_100,
             254: norm_float_0_100,
             255: norm_int_0_3,
             256: norm_float_50_200,
             257: norm_int_0_3,
             258: norm_float_0_100,
             259: norm_int_0_5,
             260: norm_int_0_3,
             261: norm_placeholder,
             262: norm_int_0_12,
             263: norm_int_0_1,
             264: norm_float_0_100,
             265: norm_float_0_100,
             266: norm_float_0_100,
             267: norm_float_0_100,
             268: norm_int_0_23,
             269: norm_float_100_100,
             270: norm_int_0_1,
             271: norm_int_0_3,
             272: norm_int_0_1,
             273: norm_int_0_1,
             274: norm_float_0_100,
             275: norm_float_0_100,
             276: norm_float_0_100,
             277: norm_float_0_100,
             278: norm_int_0_6,
             279: norm_int_0_6,
             280: norm_int_0_1}

# Save dictionary with normalization functions
with open(os.path.join(DATA_PATH, "normalize_dict.pickle"), 'wb') as handle:
    pickle.dump(norm_dict, handle, protocol=pickle.HIGHEST_PROTOCOL)

with open(os.path.join(DATA_PATH, "normalize_dict.pickle"), 'rb') as handle:
    norm_dict = pickle.load(handle)


scale_dict = {0: scale_float_0_200,
             1: scale_int_0_1,
             2: scale_int_0_1,
             3: scale_float_0_1,
             4: scale_int_0_7,
             5: scale_int_0_6,
             6: scale_int_0_4,
             7: scale_int_0_1,
             8: scale_float_0_100,
             9: scale_float_100_100,
             10: scale_float_0_100,
             11: scale_int_0_26,
             12: scale_int_0_26,
             13: scale_int_0_1,
             14: scale_int_24_24,
             15: scale_float_100_100,
             16: scale_int_0_2,
             17: scale_placeholder,
             18: scale_placeholder,
             19: scale_placeholder,
             20: scale_float_0_100,
             21: scale_float_0_100,
             22: scale_float_0_100,
             23: scale_float_0_100,
             24: scale_float_0_100,
             25: scale_float_100_100,
             26: scale_float_100_100,
             27: scale_float_100_100,
             28: scale_float_100_100,
             29: scale_float_100_100,
             30: scale_float_100_100,
             31: scale_float_100_100,
             32: scale_float_100_100,
             33: scale_float_0_100,
             34: scale_float_0_100,
             35: scale_float_0_100,
             36: scale_float_0_100,
             37: scale_float_0_100,
             38: scale_int_0_2,
             39: scale_placeholder,
             40: scale_int_0_1,
             41: scale_int_0_1,
             42: scale_int_0_1,
             43: scale_float_0_100,
             44: scale_float_0_100,
             45: scale_float_0_100,
             46: scale_float_0_100,
             47: scale_float_0_100,
             48: scale_float_0_100,
             49: scale_int_0_2,
             50: scale_placeholder,
             51: scale_int_0_1,
             52: scale_int_0_1,
             53: scale_int_0_1,
             54: scale_float_0_100,
             55: scale_int_m3_23,
             56: scale_int_0_3,
             57: scale_int_0_7,
             58: scale_float_0_100,
             59: scale_float_0_100,
             60: scale_int_0_23,
             61: scale_float_0_100,
             62: scale_float_5_5,
             63: scale_int_0_23,
             64: scale_float_5_5,
             65: scale_int_3_23,
             66: scale_int_0_3,
             67: scale_int_0_7,
             68: scale_float_0_100,
             69: scale_float_0_100,
             70: scale_int_0_23,
             71: scale_float_0_100,
             72: scale_float_5_5,
             73: scale_int_0_23,
             74: scale_float_5_5,
             75: scale_float_2_100,
             76: scale_float_0_100,
             77: scale_int_0_23,
             78: scale_int_0_23,
             79: scale_int_0_23,
             80: scale_int_0_23,
             81: scale_int_0_23,
             82: scale_int_0_23,
             83: scale_int_0_23,
             84: scale_int_0_23,
             85: scale_int_0_4,
             86: scale_fixed_octave,
             87: scale_float_30_30,
             88: scale_float_30_30,
             89: scale_float_0_100,
             90: scale_float_0_100,
             91: scale_float_1_9,
             92: scale_float_1_9,
             93: scale_float_1_9,
             94: scale_float_0_100,
             95: scale_int_0_1,
             96: scale_float_0_100,
             97: scale_float_0_100,
             98: scale_float_0_100,
             99: scale_float_0_100,
             100: scale_int_0_3,
             101: scale_int_0_5,
             102: scale_int_0_5,
             103: scale_int_0_23,
             104: scale_float_24_24,
             105: scale_int_0_23,
             106: scale_float_24_24,
             107: scale_int_0_23,
             108: scale_float_50_50,
             109: scale_int_0_23,
             110: scale_float_50_50,
             111: scale_int_0_1,
             112: scale_int_0_1,
             113: scale_int_0_1,
             114: scale_int_0_1,
             115: scale_int_0_1,
             116: scale_int_0_1,
             117: scale_int_0_1,
             118: scale_int_0_1,
             119: scale_int_0_1,
             120: scale_int_0_2,
             121: scale_int_0_1,
             122: scale_int_0_4,
             123: scale_int_0_1,
             124: scale_int_0_1,
             125: scale_int_0_1,
             126: scale_int_0_1,
             127: scale_int_0_1,
             128: scale_int_0_1,
             129: scale_int_0_1,
             130: scale_placeholder,
             131: scale_int_1_4,
             132: scale_int_1_4,
             133: scale_int_0_1,
             134: scale_float_0_200,
             135: scale_int_0_23,
             136: scale_float_100_100,
             137: scale_int_0_23,
             138: scale_float_100_100,
             139: scale_int_0_3,
             140: scale_float_30_150,
             141: scale_float_0_100,
             142: scale_int_1_2,
             143: scale_placeholder,
             144: scale_int_0_23,
             145: scale_float_120_120,
             146: scale_int_m1_3,
             147: scale_float_0_4,
             148: scale_float_0_150,
             149: scale_float_0_100,
             150: scale_int_0_23,
             151: scale_float_120_120,
             152: scale_int_0_23,
             153: scale_float_120_120,
             154: scale_float_0_100,
             155: scale_float_24_24,
             156: scale_int_0_1,
             157: scale_int_0_1,
             158: scale_int_1_2,
             159: scale_int_0_3,
             160: scale_float_0_100,
             161: scale_int_0_23,
             162: scale_float_100_100,
             163: scale_int_0_23,
             164: scale_float_24_24,
             165: scale_int_0_23,
             166: scale_float_100_100,
             167: scale_float_100_100,
             168: scale_float_0_100,
             169: scale_int_0_1,
             170: scale_int_0_23,
             171: scale_float_100_100,
             172: scale_int_0_23,
             173: scale_float_100_100,
             174: scale_int_0_23,
             175: scale_placeholder,
             176: scale_float_8_8,
             177: scale_float_5_5,
             178: scale_int_0_4,
             179: scale_int_0_2,
             180: scale_float_0_100,
             181: scale_float_0_100,
             182: scale_float_0_100,
             183: scale_int_0_1,
             184: scale_float_0_100,
             185: scale_float_0_100,
             186: scale_float_50_50,
             187: scale_int_0_1,
             188: scale_float_0_100,
             189: scale_float_0_100,
             190: scale_float_0_250,
             191: scale_float_0_100,
             192: scale_float_0_100,
             193: scale_float_0_100,
             194: scale_float_1_200,
             195: scale_float_0_100,
             196: scale_float_0_100,
             197: scale_float_1_16,
             198: scale_float_1_16,
             199: scale_float_1_16,
             200: scale_float_0_100,
             201: scale_float_0_100,
             202: scale_float_0_100,
             203: scale_float_0_100,
             204: scale_float_0_100,
             205: scale_float_0_100,
             206: scale_float_0_100,
             207: scale_int_0_2,
             208: scale_float_0_100,
             209: scale_float_0_100,
             210: scale_float_0_100,
             211: scale_float_0_100,
             212: scale_float_20_20,
             213: scale_float_0_100,
             214: scale_float_0_100,
             215: scale_float_0_100,
             216: scale_int_0_3,
             217: scale_int_0_4,
             218: scale_int_0_2,
             219: scale_float_0_100,
             220: scale_float_0_100,
             221: scale_float_0_100,
             222: scale_int_0_1,
             223: scale_float_0_100,
             224: scale_float_0_100,
             225: scale_float_50_50,
             226: scale_int_0_1,
             227: scale_float_0_100,
             228: scale_float_0_100,
             229: scale_float_0_250,
             230: scale_float_0_100,
             231: scale_float_0_100,
             232: scale_float_0_100,
             233: scale_float_1_200,
             234: scale_float_0_100,
             235: scale_float_0_100,
             236: scale_float_1_16,
             237: scale_float_1_16,
             238: scale_float_1_16,
             239: scale_float_0_100,
             240: scale_float_0_100,
             241: scale_float_0_100,
             242: scale_float_0_100,
             243: scale_float_0_100,
             244: scale_float_0_100,
             245: scale_float_0_100,
             246: scale_int_0_2,
             247: scale_float_0_100,
             248: scale_float_0_100,
             249: scale_float_0_100,
             250: scale_float_0_100,
             251: scale_float_20_20,
             252: scale_float_0_100,
             253: scale_float_0_100,
             254: scale_float_0_100,
             255: scale_int_0_3,
             256: scale_float_50_200,
             257: scale_int_0_3,
             258: scale_float_0_100,
             259: scale_int_0_5,
             260: scale_int_0_3,
             261: scale_placeholder,
             262: scale_int_0_12,
             263: scale_int_0_1,
             264: scale_float_0_100,
             265: scale_float_0_100,
             266: scale_float_0_100,
             267: scale_float_0_100,
             268: scale_int_0_23,
             269: scale_float_100_100,
             270: scale_int_0_1,
             271: scale_int_0_3,
             272: scale_int_0_1,
             273: scale_int_0_1,
             274: scale_float_0_100,
             275: scale_float_0_100,
             276: scale_float_0_100,
             277: scale_float_0_100,
             278: scale_int_0_6,
             279: scale_int_0_6,
             280: scale_int_0_1}

# Save dictionary with scaling functions
with open(os.path.join(DATA_PATH, "scaling_dict.pickle"), 'wb') as handle:
    pickle.dump(scale_dict, handle, protocol=pickle.HIGHEST_PROTOCOL)

with open(os.path.join(DATA_PATH, "scaling_dict.pickle"), 'rb') as handle:
    scale_dict = pickle.load(handle)


def patch_transform(function_dict:dict, patch):
    patch_df = pd.DataFrame(patch).transpose()
    transformed_patch = patch_df.agg(function_dict)
    transformed_patch = transformed_patch.transpose().to_numpy().flatten()

    return transformed_patch

# Get test patch to test patch_transform function
#testParams = np.load(os.path.join(DATA_PATH, "data_mfcc/test_patches.npy"))
#patch = testParams[0]

#normalized_patch = patch_transform(norm_dict, patch)
#scaled_patch = patch_transform(scale_dict, patch)

