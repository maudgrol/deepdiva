import os
import numpy as np
import pandas as pd
import pickle

from norm_functions import *
from scale_functions import *

DATA_PATH = "../data/"

norm_dict = {0: norm_float_0_200,
             1: norm_int_0_1,
             2: norm_int_0_1,
             3: norm_placeholder,
             4: norm_placeholder,
             5: norm_placeholder,
             6: norm_placeholder,
             7: norm_placeholder,
             8: norm_placeholder,
             9: norm_placeholder,
             10: norm_placeholder,
             11: norm_placeholder,
             12: norm_placeholder,
             13: norm_placeholder,
             14: norm_placeholder,
             15: norm_placeholder,
             16: norm_placeholder,
             17: norm_placeholder,
             18: norm_placeholder,
             19: norm_placeholder,
             20: norm_placeholder,
             21: norm_placeholder,
             22: norm_placeholder,
             23: norm_placeholder,
             24: norm_placeholder,
             25: norm_placeholder,
             26: norm_placeholder,
             27: norm_placeholder,
             28: norm_placeholder,
             29: norm_placeholder,
             30: norm_placeholder,
             31: norm_placeholder,
             32: norm_placeholder,
             33: norm_float_0_100,
             34: norm_float_0_100,
             35: norm_float_0_100,
             36: norm_float_0_100,
             37: norm_float_0_100,
             38: norm_int_0_2,
             39: norm_placeholder,
             40: norm_placeholder,
             41: norm_placeholder,
             42: norm_placeholder,
             43: norm_float_0_100,
             44: norm_float_0_100,
             45: norm_float_0_100,
             46: norm_float_0_100,
             47: norm_float_0_100,
             48: norm_float_0_100,
             49: norm_int_0_2,
             50: norm_placeholder,
             51: norm_placeholder,
             52: norm_placeholder,
             53: norm_placeholder,
             54: norm_float_0_100,
             55: norm_placeholder,
             56: norm_placeholder,
             57: norm_placeholder,
             58: norm_placeholder,
             59: norm_placeholder,
             60: norm_placeholder,
             61: norm_placeholder,
             62: norm_placeholder,
             63: norm_placeholder,
             64: norm_placeholder,
             65: norm_placeholder,
             66: norm_placeholder,
             67: norm_placeholder,
             68: norm_placeholder,
             69: norm_placeholder,
             70: norm_placeholder,
             71: norm_placeholder,
             72: norm_placeholder,
             73: norm_placeholder,
             74: norm_placeholder,
             75: norm_placeholder,
             76: norm_placeholder,
             77: norm_placeholder,
             78: norm_placeholder,
             79: norm_placeholder,
             80: norm_placeholder,
             81: norm_placeholder,
             82: norm_placeholder,
             83: norm_placeholder,
             84: norm_placeholder,
             85: norm_int_0_4,
             86: norm_fixed_octave,
             87: norm_float_30_30,
             88: norm_placeholder,
             89: norm_placeholder,
             90: norm_float_0_100,
             91: norm_placeholder,
             92: norm_placeholder,
             93: norm_placeholder,
             94: norm_placeholder,
             95: norm_placeholder,
             96: norm_placeholder,
             97: norm_float_0_100,
             98: norm_float_0_100,
             99: norm_placeholder,
             100: norm_placeholder,
             101: norm_placeholder,
             102: norm_placeholder,
             103: norm_int_0_22,
             104: norm_float_24_24,
             105: norm_int_0_22,
             106: norm_float_24_24,
             107: norm_placeholder,
             108: norm_placeholder,
             109: norm_placeholder,
             110: norm_placeholder,
             111: norm_placeholder,
             112: norm_placeholder,
             113: norm_placeholder,
             114: norm_placeholder,
             115: norm_placeholder,
             116: norm_placeholder,
             117: norm_placeholder,
             118: norm_placeholder,
             119: norm_placeholder,
             120: norm_placeholder,
             121: norm_placeholder,
             122: norm_placeholder,
             123: norm_placeholder,
             124: norm_placeholder,
             125: norm_placeholder,
             126: norm_placeholder,
             127: norm_placeholder,
             128: norm_placeholder,
             129: norm_placeholder,
             130: norm_placeholder,
             131: norm_int_1_4,
             132: norm_int_1_4,
             133: norm_placeholder,
             134: norm_placeholder,
             135: norm_placeholder,
             136: norm_placeholder,
             137: norm_placeholder,
             138: norm_placeholder,
             139: norm_int_0_3,
             140: norm_float_30_150,
             141: norm_float_0_100,
             142: norm_int_1_2,
             143: norm_placeholder,
             144: norm_int_0_22,
             145: norm_float_120_120,
             146: norm_placeholder,
             147: norm_int_0_4,
             148: norm_float_0_150,
             149: norm_float_0_100,
             150: norm_int_0_22,
             151: norm_float_120_120,
             152: norm_int_0_22,
             153: norm_float_120_120,
             154: norm_float_0_100,
             155: norm_float_24_24,
             156: norm_placeholder,
             157: norm_placeholder,
             158: norm_int_1_2,
             159: norm_placeholder,
             160: norm_placeholder,
             161: norm_placeholder,
             162: norm_placeholder,
             163: norm_placeholder,
             164: norm_placeholder,
             165: norm_placeholder,
             166: norm_placeholder,
             167: norm_placeholder,
             168: norm_placeholder,
             169: norm_placeholder,
             170: norm_placeholder,
             171: norm_placeholder,
             172: norm_placeholder,
             173: norm_placeholder,
             174: norm_placeholder,
             175: norm_placeholder,
             176: norm_placeholder,
             177: norm_placeholder,
             178: norm_placeholder,
             179: norm_placeholder,
             180: norm_placeholder,
             181: norm_placeholder,
             182: norm_placeholder,
             183: norm_placeholder,
             184: norm_placeholder,
             185: norm_placeholder,
             186: norm_placeholder,
             187: norm_placeholder,
             188: norm_placeholder,
             189: norm_placeholder,
             190: norm_placeholder,
             191: norm_placeholder,
             192: norm_placeholder,
             193: norm_placeholder,
             194: norm_placeholder,
             195: norm_placeholder,
             196: norm_placeholder,
             197: norm_placeholder,
             198: norm_placeholder,
             199: norm_placeholder,
             200: norm_placeholder,
             201: norm_placeholder,
             202: norm_placeholder,
             203: norm_placeholder,
             204: norm_placeholder,
             205: norm_placeholder,
             206: norm_placeholder,
             207: norm_placeholder,
             208: norm_placeholder,
             209: norm_placeholder,
             210: norm_placeholder,
             211: norm_placeholder,
             212: norm_placeholder,
             213: norm_placeholder,
             214: norm_placeholder,
             215: norm_placeholder,
             216: norm_placeholder,
             217: norm_placeholder,
             218: norm_placeholder,
             219: norm_placeholder,
             220: norm_placeholder,
             221: norm_placeholder,
             222: norm_placeholder,
             223: norm_placeholder,
             224: norm_placeholder,
             225: norm_placeholder,
             226: norm_placeholder,
             227: norm_placeholder,
             228: norm_placeholder,
             229: norm_placeholder,
             230: norm_placeholder,
             231: norm_placeholder,
             232: norm_placeholder,
             233: norm_placeholder,
             234: norm_placeholder,
             235: norm_placeholder,
             236: norm_placeholder,
             237: norm_placeholder,
             238: norm_placeholder,
             239: norm_placeholder,
             240: norm_placeholder,
             241: norm_placeholder,
             242: norm_placeholder,
             243: norm_placeholder,
             244: norm_placeholder,
             245: norm_placeholder,
             246: norm_placeholder,
             247: norm_placeholder,
             248: norm_placeholder,
             249: norm_placeholder,
             250: norm_placeholder,
             251: norm_placeholder,
             252: norm_placeholder,
             253: norm_placeholder,
             254: norm_placeholder,
             255: norm_placeholder,
             256: norm_placeholder,
             257: norm_placeholder,
             258: norm_placeholder,
             259: norm_placeholder,
             260: norm_placeholder,
             261: norm_placeholder,
             262: norm_placeholder,
             263: norm_placeholder,
             264: norm_placeholder,
             265: norm_placeholder,
             266: norm_placeholder,
             267: norm_placeholder,
             268: norm_placeholder,
             269: norm_placeholder,
             270: norm_placeholder,
             271: norm_placeholder,
             272: norm_placeholder,
             273: norm_placeholder,
             274: norm_placeholder,
             275: norm_placeholder,
             276: norm_placeholder,
             277: norm_placeholder,
             278: norm_placeholder,
             279: norm_placeholder,
             280: norm_placeholder}

# Save dictionary with normalization functions
with open(os.path.join(DATA_PATH, "normalize_dict.pickle"), 'wb') as handle:
    pickle.dump(norm_dict, handle, protocol=pickle.HIGHEST_PROTOCOL)

with open(os.path.join(DATA_PATH, "normalize_dict.pickle"), 'rb') as handle:
    norm_dict = pickle.load(handle)


scale_dict = {0: scale_float_0_200,
             1: scale_int_0_1,
             2: scale_int_0_1,
             3: scale_placeholder,
             4: scale_placeholder,
             5: scale_placeholder,
             6: scale_placeholder,
             7: scale_placeholder,
             8: scale_placeholder,
             9: scale_placeholder,
             10: scale_placeholder,
             11: scale_placeholder,
             12: scale_placeholder,
             13: scale_placeholder,
             14: scale_placeholder,
             15: scale_placeholder,
             16: scale_placeholder,
             17: scale_placeholder,
             18: scale_placeholder,
             19: scale_placeholder,
             20: scale_placeholder,
             21: scale_placeholder,
             22: scale_placeholder,
             23: scale_placeholder,
             24: scale_placeholder,
             25: scale_placeholder,
             26: scale_placeholder,
             27: scale_placeholder,
             28: scale_placeholder,
             29: scale_placeholder,
             30: scale_placeholder,
             31: scale_placeholder,
             32: scale_placeholder,
             33: scale_float_0_100,
             34: scale_float_0_100,
             35: scale_float_0_100,
             36: scale_float_0_100,
             37: scale_float_0_100,
             38: scale_int_0_2,
             39: scale_placeholder,
             40: scale_placeholder,
             41: scale_placeholder,
             42: scale_placeholder,
             43: scale_float_0_100,
             44: scale_float_0_100,
             45: scale_float_0_100,
             46: scale_float_0_100,
             47: scale_float_0_100,
             48: scale_float_0_100,
             49: scale_int_0_2,
             50: scale_placeholder,
             51: scale_placeholder,
             52: scale_placeholder,
             53: scale_placeholder,
             54: scale_float_0_100,
             55: scale_placeholder,
             56: scale_placeholder,
             57: scale_placeholder,
             58: scale_placeholder,
             59: scale_placeholder,
             60: scale_placeholder,
             61: scale_placeholder,
             62: scale_placeholder,
             63: scale_placeholder,
             64: scale_placeholder,
             65: scale_placeholder,
             66: scale_placeholder,
             67: scale_placeholder,
             68: scale_placeholder,
             69: scale_placeholder,
             70: scale_placeholder,
             71: scale_placeholder,
             72: scale_placeholder,
             73: scale_placeholder,
             74: scale_placeholder,
             75: scale_placeholder,
             76: scale_placeholder,
             77: scale_placeholder,
             78: scale_placeholder,
             79: scale_placeholder,
             80: scale_placeholder,
             81: scale_placeholder,
             82: scale_placeholder,
             83: scale_placeholder,
             84: scale_placeholder,
             85: scale_int_0_4,
             86: scale_fixed_octave,
             87: scale_float_30_30,
             88: scale_placeholder,
             89: scale_placeholder,
             90: scale_float_0_100,
             91: scale_placeholder,
             92: scale_placeholder,
             93: scale_placeholder,
             94: scale_placeholder,
             95: scale_placeholder,
             96: scale_placeholder,
             97: scale_float_0_100,
             98: scale_float_0_100,
             99: scale_placeholder,
             100: scale_placeholder,
             101: scale_placeholder,
             102: scale_placeholder,
             103: scale_int_0_22,
             104: scale_float_24_24,
             105: scale_int_0_22,
             106: scale_float_24_24,
             107: scale_placeholder,
             108: scale_placeholder,
             109: scale_placeholder,
             110: scale_placeholder,
             111: scale_placeholder,
             112: scale_placeholder,
             113: scale_placeholder,
             114: scale_placeholder,
             115: scale_placeholder,
             116: scale_placeholder,
             117: scale_placeholder,
             118: scale_placeholder,
             119: scale_placeholder,
             120: scale_placeholder,
             121: scale_placeholder,
             122: scale_placeholder,
             123: scale_placeholder,
             124: scale_placeholder,
             125: scale_placeholder,
             126: scale_placeholder,
             127: scale_placeholder,
             128: scale_placeholder,
             129: scale_placeholder,
             130: scale_placeholder,
             131: scale_int_1_4,
             132: scale_int_1_4,
             133: scale_placeholder,
             134: scale_placeholder,
             135: scale_placeholder,
             136: scale_placeholder,
             137: scale_placeholder,
             138: scale_placeholder,
             139: scale_int_0_3,
             140: scale_float_30_150,
             141: scale_float_0_100,
             142: scale_int_1_2,
             143: scale_placeholder,
             144: scale_int_0_22,
             145: scale_float_120_120,
             146: scale_placeholder,
             147: scale_int_0_4,
             148: scale_float_0_150,
             149: scale_float_0_100,
             150: scale_int_0_22,
             151: scale_float_120_120,
             152: scale_int_0_22,
             153: scale_float_120_120,
             154: scale_float_0_100,
             155: scale_float_24_24,
             156: scale_placeholder,
             157: scale_placeholder,
             158: scale_int_1_2,
             159: scale_placeholder,
             160: scale_placeholder,
             161: scale_placeholder,
             162: scale_placeholder,
             163: scale_placeholder,
             164: scale_placeholder,
             165: scale_placeholder,
             166: scale_placeholder,
             167: scale_placeholder,
             168: scale_placeholder,
             169: scale_placeholder,
             170: scale_placeholder,
             171: scale_placeholder,
             172: scale_placeholder,
             173: scale_placeholder,
             174: scale_placeholder,
             175: scale_placeholder,
             176: scale_placeholder,
             177: scale_placeholder,
             178: scale_placeholder,
             179: scale_placeholder,
             180: scale_placeholder,
             181: scale_placeholder,
             182: scale_placeholder,
             183: scale_placeholder,
             184: scale_placeholder,
             185: scale_placeholder,
             186: scale_placeholder,
             187: scale_placeholder,
             188: scale_placeholder,
             189: scale_placeholder,
             190: scale_placeholder,
             191: scale_placeholder,
             192: scale_placeholder,
             193: scale_placeholder,
             194: scale_placeholder,
             195: scale_placeholder,
             196: scale_placeholder,
             197: scale_placeholder,
             198: scale_placeholder,
             199: scale_placeholder,
             200: scale_placeholder,
             201: scale_placeholder,
             202: scale_placeholder,
             203: scale_placeholder,
             204: scale_placeholder,
             205: scale_placeholder,
             206: scale_placeholder,
             207: scale_placeholder,
             208: scale_placeholder,
             209: scale_placeholder,
             210: scale_placeholder,
             211: scale_placeholder,
             212: scale_placeholder,
             213: scale_placeholder,
             214: scale_placeholder,
             215: scale_placeholder,
             216: scale_placeholder,
             217: scale_placeholder,
             218: scale_placeholder,
             219: scale_placeholder,
             220: scale_placeholder,
             221: scale_placeholder,
             222: scale_placeholder,
             223: scale_placeholder,
             224: scale_placeholder,
             225: scale_placeholder,
             226: scale_placeholder,
             227: scale_placeholder,
             228: scale_placeholder,
             229: scale_placeholder,
             230: scale_placeholder,
             231: scale_placeholder,
             232: scale_placeholder,
             233: scale_placeholder,
             234: scale_placeholder,
             235: scale_placeholder,
             236: scale_placeholder,
             237: scale_placeholder,
             238: scale_placeholder,
             239: scale_placeholder,
             240: scale_placeholder,
             241: scale_placeholder,
             242: scale_placeholder,
             243: scale_placeholder,
             244: scale_placeholder,
             245: scale_placeholder,
             246: scale_placeholder,
             247: scale_placeholder,
             248: scale_placeholder,
             249: scale_placeholder,
             250: scale_placeholder,
             251: scale_placeholder,
             252: scale_placeholder,
             253: scale_placeholder,
             254: scale_placeholder,
             255: scale_placeholder,
             256: scale_placeholder,
             257: scale_placeholder,
             258: scale_placeholder,
             259: scale_placeholder,
             260: scale_placeholder,
             261: scale_placeholder,
             262: scale_placeholder,
             263: scale_placeholder,
             264: scale_placeholder,
             265: scale_placeholder,
             266: scale_placeholder,
             267: scale_placeholder,
             268: scale_placeholder,
             269: scale_placeholder,
             270: scale_placeholder,
             271: scale_placeholder,
             272: scale_placeholder,
             273: scale_placeholder,
             274: scale_placeholder,
             275: scale_placeholder,
             276: scale_placeholder,
             277: scale_placeholder,
             278: scale_placeholder,
             279: scale_placeholder,
             280: scale_placeholder}

# Save dictionary with scaling functions
with open(os.path.join(DATA_PATH, "scaling_dict.pickle"), 'wb') as handle:
    pickle.dump(scale_dict, handle, protocol=pickle.HIGHEST_PROTOCOL)

with open(os.path.join(DATA_PATH, "scaling_dict.pickle"), 'rb') as handle:
    scale_dict = pickle.load(handle)


def patch_transform(function_dict:dict, patch):
    patch_df = pd.DataFrame(patch).transpose()
    transformed_patch = patch_df.agg(function_dict)
    transformed_patch = transformed_patch.transpose().to_numpy().flatten()

    return transformed_patch

# Get test patch to test patch_transform function
testParams = np.load(os.path.join(DATA_PATH, "data_mfcc/test_patches.npy"))
patch = testParams[0]

normalized_patch = patch_transform(norm_dict, patch)
scaled_patch = patch_transform(scale_dict, patch)

